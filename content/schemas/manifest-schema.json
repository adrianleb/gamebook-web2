{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://github.com/adrianleb/gamebook-web2/content/schemas/manifest-schema.json",
  "title": "Gamebook Manifest",
  "description": "Root manifest defining game structure: acts, hubs, endings, and scene index for The Understage gamebook adaptation. Aligned with engine types.ts canonical definitions.",
  "type": "object",
  "required": ["gamebook", "structure", "startingScene", "acts", "endings", "sceneIndex", "implementationStatus"],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference for validation"
    },
    "gamebook": {
      "type": "object",
      "required": ["title", "source", "version", "adaptationVersion"],
      "properties": {
        "title": {
          "type": "string",
          "description": "Title of the source gamebook",
          "minLength": 1
        },
        "source": {
          "type": "string",
          "description": "Source identifier (e.g., 'the-understage')",
          "minLength": 1
        },
        "version": {
          "type": "string",
          "description": "Source gamebook version",
          "minLength": 1
        },
        "adaptationVersion": {
          "type": "string",
          "description": "Content version for save compatibility (semantic versioning)",
          "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$"
        }
      }
    },
    "structure": {
      "type": "object",
      "required": ["acts", "totalNodesEstimated", "endings"],
      "properties": {
        "acts": {
          "type": "integer",
          "minimum": 1,
          "description": "Number of acts in the game"
        },
        "totalNodesEstimated": {
          "type": "integer",
          "minimum": 1,
          "description": "Estimated total scene count"
        },
        "endings": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of possible endings"
        }
      }
    },
    "startingScene": {
      "type": "string",
      "description": "ID of the opening scene",
      "pattern": "^(sc_|bk_)[a-z0-9_-]+$"
    },
    "acts": {
      "type": "array",
      "description": "Act/chapter divisions for narrative structure",
      "items": {
        "type": "object",
        "required": ["id", "title", "theme", "estimatedNodes", "hubs"],
        "properties": {
          "id": {
            "type": "integer",
            "minimum": 1,
            "description": "Act number"
          },
          "title": {
            "type": "string",
            "minLength": 1,
            "description": "Act title"
          },
          "theme": {
            "type": "string",
            "description": "Thematic focus of this act"
          },
          "estimatedNodes": {
            "type": "integer",
            "minimum": 1,
            "description": "Estimated scene count in this act"
          },
          "hubs": {
            "type": "array",
            "description": "Hub locations within this act",
            "items": {
              "type": "object",
              "required": ["id", "title"],
              "properties": {
                "id": {
                  "type": "integer",
                  "minimum": 0
                },
                "title": {
                  "type": "string",
                  "minLength": 1
                },
                "description": {
                  "type": "string"
                },
                "idRange": {
                  "type": "string",
                  "description": "Scene ID range for this hub (e.g., 'sc_1_0_001 - sc_1_0_050')"
                },
                "keyLocations": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  },
                  "description": "Key locations in this hub"
                },
                "npcs": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  },
                  "description": "NPCs found in this hub"
                },
                "branchPaths": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "required": ["id", "name", "description"],
                    "properties": {
                      "id": {
                        "type": "string"
                      },
                      "name": {
                        "type": "string"
                      },
                      "description": {
                        "type": "string"
                      },
                      "faction": {
                        "type": "string"
                      }
                    }
                  },
                  "description": "Branching path options"
                },
                "convergenceScene": {
                  "type": "string",
                  "description": "Scene where paths converge",
                  "pattern": "^(sc_|bk_)[a-z0-9_-]+$"
                },
                "convergenceTitle": {
                  "type": "string",
                  "description": "Title of convergence point"
                }
              }
            }
          }
        }
      }
    },
    "endings": {
      "type": "array",
      "description": "All possible ending scenes with their achievement conditions",
      "items": {
        "type": "object",
        "required": ["id", "sceneId", "title", "description", "tier", "requirements"],
        "properties": {
          "id": {
            "type": "integer",
            "minimum": 1,
            "description": "Ending ID number"
          },
          "sceneId": {
            "type": "string",
            "description": "Scene ID that triggers this ending",
            "pattern": "^(sc_|bk_)[a-z0-9_-]+$"
          },
          "title": {
            "type": "string",
            "description": "Display name of the ending",
            "minLength": 1
          },
          "description": {
            "type": "string",
            "description": "Flavor text for the ending"
          },
          "tier": {
            "type": "string",
            "description": "Ending tier/ranking"
          },
          "requirements": {
            "type": "object",
            "description": "Ending achievement requirements",
            "properties": {
              "faction": {
                "type": "string",
                "description": "Required faction"
              },
              "factionLevel": {
                "type": "integer",
                "description": "Required faction level"
              },
              "editorState": {
                "type": "string",
                "description": "Required editor state"
              },
              "finalChoice": {
                "type": "string",
                "description": "Required final choice ID"
              }
            }
          }
        }
      }
    },
    "sceneIndex": {
      "type": "object",
      "description": "Complete index of all scene IDs in the game as a map",
      "patternProperties": {
        "^(sc_|bk_)[a-z0-9_-]+$": {
          "type": "object",
          "required": ["title", "location", "act", "hub", "status"],
          "properties": {
            "title": {
              "type": "string",
              "description": "Scene title"
            },
            "location": {
              "type": "string",
              "description": "Scene location"
            },
            "act": {
              "type": "integer",
              "description": "Act number"
            },
            "hub": {
              "type": "integer",
              "description": "Hub number within act"
            },
            "status": {
              "type": "string",
              "enum": ["pending", "draft", "complete", "reviewed"],
              "description": "Implementation status"
            },
            "description": {
              "type": "string",
              "description": "Scene description for content tracking"
            },
            "mechanics": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Mechanics used in this scene"
            },
            "ending": {
              "type": "boolean",
              "description": "Whether this is an ending scene"
            },
            "endingId": {
              "oneOf": [
                { "type": "string" },
                { "type": "integer" },
                { "type": "null" }
              ],
              "description": "Associated ending ID if this is an ending scene"
            }
          }
        }
      },
      "additionalProperties": false
    },
    "implementationStatus": {
      "type": "object",
      "required": ["totalScenes", "pending", "draft", "complete", "reviewed"],
      "properties": {
        "totalScenes": {
          "type": "integer",
          "minimum": 0
        },
        "pending": {
          "type": "integer",
          "minimum": 0
        },
        "draft": {
          "type": "integer",
          "minimum": 0
        },
        "complete": {
          "type": "integer",
          "minimum": 0
        },
        "reviewed": {
          "type": "integer",
          "minimum": 0
        }
      }
    }
  }
}
