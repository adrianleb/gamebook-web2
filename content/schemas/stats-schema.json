{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://github.com/adrianleb/gamebook-web2/content/schemas/stats-schema.json",
  "title": "Gamebook Stats System",
  "description": "Stat definitions, archetypes, and check types for The Understage RPG mechanics",
  "type": "object",
  "required": ["stats", "checks"],
  "properties": {
    "$schema": {
      "type": "string"
    },
    "stats": {
      "type": "object",
      "description": "All stat definitions keyed by stat ID",
      "additionalProperties": {
        "type": "object",
        "required": ["id", "name", "min", "max", "initial"],
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^[a-z0-9_]+$",
            "description": "Unique stat identifier"
          },
          "name": {
            "type": "string",
            "minLength": 1,
            "description": "Display name"
          },
          "shortName": {
            "type": "string",
            "description": "Abbreviated name for UI (e.g., 'STR' for 'Strength')"
          },
          "description": {
            "type": "string",
            "description": "Description shown in character sheet"
          },
          "min": {
            "type": "integer",
            "description": "Minimum possible value"
          },
          "max": {
            "type": "integer",
            "description": "Maximum possible value"
          },
          "initial": {
            "type": "integer",
            "description": "Starting value"
          },
          "color": {
            "type": "string",
            "pattern": "^#[0-9a-fA-F]{6}$",
            "description": "Hex color for UI display"
          },
          "icon": {
            "type": "string",
            "description": "Icon identifier"
          },
          "hidden": {
            "type": "boolean",
            "default": false,
            "description": "Hidden stats don't display in normal UI"
          },
          "derived": {
            "type": "boolean",
            "default": false,
            "description": "Derived stats calculate from other stats"
          },
          "formula": {
            "type": "string",
            "description": "Formula for derived stats (e.g., 'strength + agility / 2')"
          },
          "category": {
            "type": "string",
            "enum": ["core", "resource", "derived", "special"],
            "default": "core",
            "description": "Stat category affects display and calculation"
          }
        }
      }
    },
    "archetypes": {
      "type": "object",
      "description": "Character archetypes with default stat distributions",
      "additionalProperties": {
        "type": "object",
        "required": ["id", "name", "description", "stats"],
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^[a-z0-9_]+$"
          },
          "name": {
            "type": "string",
            "minLength": 1
          },
          "description": {
            "type": "string"
          },
          "stats": {
            "type": "object",
            "description": "Stat values for this archetype (keys match stats above)",
            "additionalProperties": {
              "type": "integer"
            }
          },
          "bonuses": {
            "type": "object",
            "description": "Special bonuses or abilities",
            "additionalProperties": {
              "type": "string"
            }
          },
          "startingItems": {
            "type": "array",
            "description": "Item IDs granted to this archetype",
            "items": {
              "type": "string"
            }
          }
        }
      }
    },
    "checks": {
      "type": "object",
      "description": "Check type definitions for stat tests",
      "additionalProperties": {
        "type": "object",
        "required": ["id", "name", "stat"],
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^[a-z0-9_]+$"
          },
          "name": {
            "type": "string",
            "minLength": 1
          },
          "stat": {
            "type": "string",
            "description": "Primary stat used for this check"
          },
          "secondaryStat": {
            "type": "string",
            "description": "Optional secondary stat that adds bonus"
          },
          "difficulty": {
            "type": "string",
            "enum": ["easy", "medium", "hard", "extreme"],
            "default": "medium",
            "description": "Base difficulty tier"
          },
          "formula": {
            "type": "string",
            "description": "Custom formula (e.g., 'stat + d20 >= difficulty')"
          },
          "flavor": {
            "type": "object",
            "description": "Flavor text by outcome tier",
            "properties": {
              "criticalSuccess": {
                "type": "string"
              },
              "success": {
                "type": "string"
              },
              "failure": {
                "type": "string"
              },
              "criticalFailure": {
                "type": "string"
              }
            }
          }
        }
      }
    },
    "difficultyTiers": {
      "type": "object",
      "description": "Difficulty thresholds for stat checks",
      "properties": {
        "easy": {
          "type": "integer",
          "description": "DC for easy checks"
        },
        "medium": {
          "type": "integer",
          "description": "DC for medium checks"
        },
        "hard": {
          "type": "integer",
          "description": "DC for hard checks"
        },
        "extreme": {
          "type": "integer",
          "description": "DC for extreme checks"
        }
      }
    },
    "checkFormat": {
      "type": "string",
      "enum": ["d20", "d100", "dice_pool", "static"],
      "description": "Default check mechanic: d20+stat, d00-under, pool counting 5+, or static comparison",
      "default": "d20"
    }
  }
}
