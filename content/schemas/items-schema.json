{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://github.com/adrianleb/gamebook-web2/content/schemas/items-schema.json",
  "title": "Gamebook Items Catalog",
  "description": "Item definitions for inventory system including categories, properties, and combination rules",
  "type": "object",
  "required": ["items", "categories"],
  "properties": {
    "$schema": {
      "type": "string"
    },
    "items": {
      "type": "object",
      "description": "Catalog of all items in the game, keyed by item ID",
      "additionalProperties": {
        "type": "object",
        "required": ["id", "name", "category"],
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^[a-z0-9_-]+$",
            "description": "Unique item identifier"
          },
          "name": {
            "type": "string",
            "minLength": 1,
            "description": "Display name"
          },
          "plural": {
            "type": "string",
            "description": "Plural form (defaults to name + 's')"
          },
          "description": {
            "type": "string",
            "description": "Item description shown in inventory"
          },
          "category": {
            "type": "string",
            "description": "Must reference a key in the categories object"
          },
          "icon": {
            "type": "string",
            "description": "Icon identifier for UI display"
          },
          "maxQuantity": {
            "type": "integer",
            "minimum": 1,
            "default": 99,
            "description": "Maximum stackable quantity"
          },
          "consumable": {
            "type": "boolean",
            "default": false,
            "description": "If true, item is consumed when used"
          },
          "value": {
            "type": "integer",
            "minimum": 0,
            "description": "Optional gold/value amount"
          },
          "effects": {
            "type": "array",
            "description": "Effects applied when item is used",
            "items": {
              "$ref": "#/$defs/itemEffect"
            }
          },
          "usable": {
            "type": "boolean",
            "default": false,
            "description": "Can be used from inventory menu"
          },
          "usableInCombat": {
            "type": "boolean",
            "default": false,
            "description": "Can be used during combat encounters"
          },
          "equipable": {
            "type": "boolean",
            "default": false,
            "description": "Can be equipped to a slot"
          },
          "slot": {
            "type": "string",
            "enum": ["weapon", "armor", "accessory", "tool", "misc"],
            "description": "Equipment slot (required if equipable=true)"
          },
          "bonuses": {
            "type": "object",
            "description": "Stat bonuses when equipped",
            "additionalProperties": {
              "type": "object",
              "required": ["statId", "value"],
              "properties": {
                "statId": {
                  "type": "string"
                },
                "value": {
                  "type": ["integer", "number"]
                }
              }
            }
          },
          "combinations": {
            "type": "array",
            "description": "Items this can combine with",
            "items": {
              "type": "object",
              "required": ["withItemId", "result"],
              "properties": {
                "withItemId": {
                  "type": "string"
                },
                "result": {
                  "type": "string",
                  "description": "Resulting item ID"
                },
                "quantity": {
                  "type": "integer",
                  "minimum": 1,
                  "default": 1
                },
                "description": {
                  "type": "string",
                  "description": "Flavor text for the combination"
                }
              }
            }
          },
          "keyItem": {
            "type": "boolean",
            "default": false,
            "description": "Key items cannot be dropped"
          },
          "hidden": {
            "type": "boolean",
            "default": false,
            "description": "Hidden items don't appear in inventory until revealed"
          },
          "tags": {
            "type": "array",
            "description": "Custom tags for logic filtering",
            "items": {
              "type": "string"
            }
          }
        }
      }
    },
    "categories": {
      "type": "object",
      "description": "Item category definitions",
      "additionalProperties": {
        "type": "object",
        "required": ["id", "name", "icon"],
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^[a-z0-9_-]+$"
          },
          "name": {
            "type": "string",
            "minLength": 1
          },
          "icon": {
            "type": "string",
            "description": "Icon identifier"
          },
          "description": {
            "type": "string"
          },
          "sortOrder": {
            "type": "integer",
            "default": 0,
            "description": "Display order in inventory"
          }
        }
      }
    },
    "startingItems": {
      "type": "object",
      "description": "Items granted to player at game start",
      "additionalProperties": {
        "type": "integer",
        "minimum": 1,
        "description": "Quantity (key is item ID)"
      }
    }
  },
  "$defs": {
    "itemEffect": {
      "oneOf": [
        {
          "type": "object",
          "required": ["type", "statId", "value"],
          "properties": {
            "type": {
              "const": "restore_stat"
            },
            "statId": {
              "type": "string"
            },
            "value": {
              "type": "number"
            }
          }
        },
        {
          "type": "object",
          "required": ["type", "flag"],
          "properties": {
            "type": {
              "const": "set_flag"
            },
            "flag": {
              "type": "string"
            }
          }
        },
        {
          "type": "object",
          "required": ["type", "itemId"],
          "properties": {
            "type": {
              "const": "add_item"
            },
            "itemId": {
              "type": "string"
            },
            "quantity": {
              "type": "integer",
              "minimum": 1,
              "default": 1
            }
          }
        },
        {
          "type": "object",
          "required": ["type"],
          "properties": {
            "type": {
              "const": "teleport"
            },
            "sceneId": {
              "type": "string"
            }
          }
        },
        {
          "type": "object",
          "required": ["type", "text"],
          "properties": {
            "type": {
              "const": "flavor_text"
            },
            "text": {
              "type": "string"
            }
          }
        }
      ]
    }
  }
}
