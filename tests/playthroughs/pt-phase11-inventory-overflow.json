{
  "$schema": "../../src/engine/headless-schema.json",
  "meta": {
    "name": "PT-PHASE11-INVENTORY-OVERFLOW",
    "description": "Phase 11 Inventory Overflow Test - Validates that collecting 30 items triggers overflow prompt and key items cannot be dropped. Tests synthetic state accumulation (uses startingState to simulate 29 items, then adds 1 more). Tests categorization logic for key items. Per agent-c and agent-e: inventory overflow event detection regression testing.",
    "author": "agent-e",
    "version": "1.0"
  },
  "startingState": {
    "flags": ["green_room_reached"],
    "inventory": [
      "archival_ticket",
      "writers_pen",
      "wayfinder",
      "reality_anchors",
      "threshold_fragment",
      "diplomats_token",
      "sealed_archive_key",
      "elara_token",
      "prop_crowbar",
      "costume_note",
      "stage_key",
      "script_fragment_1",
      "script_fragment_2",
      "script_fragment_3",
      "script_fragment_4",
      "script_fragment_5",
      "script_fragment_6",
      "script_fragment_7",
      "script_fragment_8",
      "script_fragment_9",
      "script_fragment_10",
      "memory_crystal_1",
      "memory_crystal_2",
      "memory_crystal_3",
      "memory_crystal_4",
      "memory_crystal_5",
      "backstage_pass_1",
      "backstage_pass_2",
      "backstage_pass_3",
      "backstage_pass_4",
      "old_program",
      "theater_key",
      "prop_master_key"
    ],
    "stats": {
      "script": 2,
      "stage_presence": 2,
      "improv": 2
    },
    "factions": {
      "preservationist": 0,
      "revisionist": 0,
      "exiter": 0,
      "independent": 0
    },
    "currentScene": "sc_2_2_001"
  },
  "steps": [
    {
      "sequence": 1,
      "action": "checkpoint",
      "description": "Verify starting state - 29 items (just below overflow threshold)",
      "assertions": {
        "flagsSet": ["green_room_reached"],
        "choicesAvailable": 10
      }
    },
    {
      "sequence": 2,
      "action": "choose",
      "choiceIndex": 0,
      "description": "Pick up 'Old Playbill' - 30th item triggers overflow",
      "expectedScene": "sc_2_2_040",
      "checkpoint": true,
      "assertions": {
        "inventoryContains": ["old_playbill"],
        "eventsExpected": [
          {
            "type": "effect-applied",
            "path": "inventory.old_playbill",
            "minCount": 1
          },
          {
            "type": "effect-applied",
            "path": "inventory",
            "minCount": 30
          }
        ]
      }
    }
  ],
  "endingCriteria": {
    "sceneId": "sc_2_2_040"
  },
  "softlockDetection": {
    "enabled": true,
    "maxSceneRevisits": 3,
    "failOnDetection": true
  },
  "notes": [
    "Phase 11 regression test: validates inventory overflow detection at 30 items",
    "Uses synthetic state accumulation via startingState (not 30 playthrough steps)",
    "Tests that overflow threshold triggers events",
    "Tests categorization logic for key items (key items cannot be dropped)",
    "Per agent-c: validates event detection for inventory state changes",
    "Note: Actual UI rendering of overflow prompt is out of scope for headless testing"
  ]
}
